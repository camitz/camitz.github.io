

<!doctype html>
<html lang="sv" class="no-js">
  <head>
    

<meta charset="utf-8">



<!-- begin SEO -->









<title>MiniProfiler for Model First EF and Unity - Cozmiq Debris</title>







<meta property="og:locale" content="sv-SE">
<meta property="og:site_name" content="Cozmiq Debris">
<meta property="og:title" content="MiniProfiler for Model First EF and Unity">


  <link rel="canonical" href="http://blog.simpletask.se/MiniProfiler-Model-First-EF-Unity">
  <meta property="og:url" content="http://blog.simpletask.se/MiniProfiler-Model-First-EF-Unity">



  <meta property="og:description" content="I know there is good rational behind putting off code optimizations, but I think we’ve been going overboard with that theme. So it was with relief that my boss told me now is the time to start profiling. Time to install MiniProfiler, in other words. Current version is 2.0.2.">



  <meta name="twitter:site" content="@martincamitz">
  <meta name="twitter:title" content="MiniProfiler for Model First EF and Unity">
  <meta name="twitter:description" content="I know there is good rational behind putting off code optimizations, but I think we’ve been going overboard with that theme. So it was with relief that my boss told me now is the time to start profiling. Time to install MiniProfiler, in other words. Current version is 2.0.2.">
  <meta name="twitter:url" content="http://blog.simpletask.se/MiniProfiler-Model-First-EF-Unity">

  
    <meta name="twitter:card" content="summary">
    
  

  



  

  





  <meta property="og:type" content="article">
  <meta property="article:published_time" content="2012-11-29T00:35:00+00:00">
  
    <link rel="next" href="http://blog.simpletask.se/zerohate" title="Zero Hate">
  
  
    <link rel="prev" href="http://blog.simpletask.se/MiniProfiler-Model-First-EF-Unity" title="MiniProfiler for Model First EF and Unity">
  





  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "person",
      "name" : "Martin Camitz",
      "url" : "http://blog.simpletask.se",
      "sameAs" : null
    }
  </script>






<!-- end SEO -->

<link href="http://blog.simpletask.se/feed.xml" type="application/atom+xml" rel="alternate" title="Cozmiq Debris Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="http://blog.simpletask.se/assets/css/main.css">

<meta http-equiv="cleartype" content="on">
    <!-- start custom head snippets -->

<!-- insert favicons. use http://realfavicongenerator.net/ -->

<!-- end custom head snippets -->
  </head>

  <body>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->
    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <button><div class="navicon"></div></button>
        <ul class="visible-links">
          <li class="masthead__menu-item masthead__menu-item--lg"><a href="http://blog.simpletask.se/">Cozmiq Debris</a></li>
          
        </ul>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    





<div id="main" role="main">
  


  <div class="sidebar sticky">
  



<div itemscope itemtype="http://schema.org/Person">

  <div class="author__avatar">
    
    	<img src="http://blog.simpletask.se/images/bio-photo.jpg" class="author__avatar" alt="Martin Camitz">
    
  </div>

  <div class="author__content">
    <h3 class="author__name">Martin Camitz</h3>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li><i class="fa fa-fw fa-map-marker" aria-hidden="true"></i> Stockholm</li>
      
      
      
        <li><a href="mailto:martin.camitz@simpletask.se"><i class="fa fa-fw fa-envelope-square" aria-hidden="true"></i> </a></li>
      
      
      
        <li><a href="https://twitter.com/martin.camitz"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
      
      
      
      
      
      
      
      
      
      
        <li><a href="https://www.stackoverflow.com/users/http://stackoverflow.com/users/168390/martin"><i class="fa fa-fw fa-stack-overflow" aria-hidden="true"></i> Stackoverflow</a></li>
      
      
      
      
      
      
      
      
      
      
      
      
    </ul>
  </div>
</div>

  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="MiniProfiler for Model First EF and Unity">
    <meta itemprop="description" content="I know there is good rational behind putting off code optimizations, but I think we’ve been going overboard with that theme. So it was with relief that my boss told me now is the time to start profiling. Time to install MiniProfiler, in other words. Current version is 2.0.2.">
    <meta itemprop="datePublished" content="November 29, 2012">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 class="page__title" itemprop="headline">MiniProfiler for Model First EF and Unity
</h1>
          
            <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  1 
</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        I know there is good rational behind putting off code optimizations, but I think we've been going overboard with that theme. So it was with relief that my boss told me now is the time to start profiling. Time to install [MiniProfiler](http://www.miniprofiler.com), in other words. Current version is 2.0.2.

I don't know how people can live without it. It's love and kittens for Asp.NET MVC developers, as [Scott H](http://www.hanselman.com/blog/NuGetPackageOfTheWeek9ASPNETMiniProfilerFromStackExchangeRocksYourWorld.aspx) says.

I've been using it for some time on several projects but I haven't installed the Entity Framework till now. That took a bit of head scratching as most of the stuff out there, including MiniProfiler docs, is about Code First setups. Some of my code is getting a bit antiquated, not least my Model First EF 4.2 usage. I just don't know what the stuff on miniprofiler.com means.

## EF MiniProfiler for Model First projects

Nevertheless, [help](http://stackoverflow.com/a/6805478/168390) was available - as countless times before - signed Darin Dimitrov.

    var connectionString = ConfigurationManager
        .ConnectionStrings["MyConnectionString"]
        .ConnectionString;
    var ecsb = new EntityConnectionStringBuilder(connectionString);
    var sqlConn = new SqlConnection(ecsb.ProviderConnectionString);
    var pConn = ProfiledDbConnection.Get(sqlConn, MiniProfiler.Current);
    var context = ObjectContextUtils.CreateObjectContext<CYEntities>(pConn);

## What about Unity Container?

I'm also using Unity Container to inject my object context so if I'm going to put the above anywhere, it's in my container. Previously my container was configured like this.

    IUnityContainer container = new UnityContainer()
    	.RegisterType<CYEntities>(new PerHttpRequestLifetime(), new InjectionConstructor(connectionString));

I need to use a customized piece of code to do the creating for me and I recall this is what is known as a factory. Unity supports this through InjectionFactory.

Hence 

    IUnityContainer container = new UnityContainer()
        .RegisterType<CYEntities>(GetLiftimeManager(lifeTimeManagerType), 
             new InjectionFactory(c=> {
				var ecsb = new EntityConnectionStringBuilder(connectionString);                                                                                                                 var sqlConn = new SqlConnection(ecsb.ProviderConnectionString);                                                                                                                 var pConn = new EFProfiledDbConnection(sqlConn, MiniProfiler.Current);                                                                                                                 return pConn.CreateObjectContext<CoinEntities>(); 
			 }));
	
And it works, too.

<div id="disqus_thread"></div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'martincamitz'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        
      </section>

      <footer class="page__meta">
        
        


  




  
  
  

  <p class="page__taxonomy">
    <strong><i class="fa fa-fw fa-tags" aria-hidden="true"></i>  </strong>
    <span itemprop="keywords">
    
      
      
      <a href="http://blog.simpletask.se/tags/#asp-net-mvc" class="page__taxonomy-item" rel="tag">asp.net mvc</a><span class="sep">, </span>
    
      
      
      <a href="http://blog.simpletask.se/tags/#ef" class="page__taxonomy-item" rel="tag">ef</a><span class="sep">, </span>
    
      
      
      <a href="http://blog.simpletask.se/tags/#entity-framework" class="page__taxonomy-item" rel="tag">entity framework</a><span class="sep">, </span>
    
      
      
      <a href="http://blog.simpletask.se/tags/#miniprofiler" class="page__taxonomy-item" rel="tag">miniprofiler</a><span class="sep">, </span>
    
      
      
      <a href="http://blog.simpletask.se/tags/#unity-container" class="page__taxonomy-item" rel="tag">unity container</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fa fa-fw fa-calendar" aria-hidden="true"></i> </strong> <time datetime="2012-11-29T00:35:00+00:00">November 29, 2012</time></p>
        
      </footer>

      

<section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=http://blog.simpletask.se/MiniProfiler-Model-First-EF-Unity" class="btn btn--twitter" title=" Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http://blog.simpletask.se/MiniProfiler-Model-First-EF-Unity" class="btn btn--facebook" title=" Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http://blog.simpletask.se/MiniProfiler-Model-First-EF-Unity" class="btn btn--google-plus" title=" Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http://blog.simpletask.se/MiniProfiler-Model-First-EF-Unity" class="btn btn--linkedin" title=" LinkedIn"><i class="fa fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>

      


  <nav class="pagination">
    
      <a href="http://blog.simpletask.se/MiniProfiler-Model-First-EF-Unity" class="pagination--pager" title="MiniProfiler for Model First EF and Unity
"></a>
    
    
      <a href="http://blog.simpletask.se/zerohate" class="pagination--pager" title="Zero Hate
"></a>
    
  </nav>

    </div>

    
      

<div class="page__comments">
  <h4 class="page__comments-title"></h4>
  
    <section id="disqus_thread"></section>
  
</div>
    
  </article>

  
  
    <div class="page__related">
      
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  
    <a href="http://blog.simpletask.se/EC2SpotStop2SNS">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
      <h2 class="archive__item-title" itemprop="headline">EC2 Spot Instance Termination Notification to SNS
</h2>
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  2 
</p>
      
      <p class="archive__item-excerpt" itemprop="description">The AWS team yesterday announced that it would publish notifications of imminent termination of spot instances in the form of a date string accesible via the...</p>
    </article>
  </a>
</div>
        
          



<div class="grid__item">
  
    <a href="http://blog.simpletask.se/buffering-aggregating-cloudwatch-appender">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
      <h2 class="archive__item-title" itemprop="headline">Introducing the Buffering and Aggregeting CloudWatch Appender
</h2>
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  6 
</p>
      
      <p class="archive__item-excerpt" itemprop="description">The CloudWatch Appender for log4net is an appender that targets AWS CloudWatch. So if you have any kind of service on the Amazon cloud you can easily forward...</p>
    </article>
  </a>
</div>
        
          



<div class="grid__item">
  
    <a href="http://blog.simpletask.se/buffering-aggregating-cloudwatch-appender">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
      <h2 class="archive__item-title" itemprop="headline">Introducing the Buffering and Aggregeting CloudWatch Appender
</h2>
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  6 
</p>
      
      <p class="archive__item-excerpt" itemprop="description">The CloudWatch Appender for log4net is an appender that targets AWS CloudWatch. So if you have any kind of service on the Amazon cloud you can easily forward...</p>
    </article>
  </a>
</div>
        
          



<div class="grid__item">
  
    <a href="http://blog.simpletask.se/welcome to russia dear crimeans">
  
    <article class="archive__item" itemscope itemtype="http://schema.org/CreativeWork">
      
      <h2 class="archive__item-title" itemprop="headline">Welcome to Russia, dear Crimeans!
</h2>
      
        <p class="page__meta"><i class="fa fa-clock-o" aria-hidden="true"></i> 


  6 
</p>
      
      <p class="archive__item-excerpt" itemprop="description">by Arkady Babtjenko

</p>
    </article>
  </a>
</div>
        
      </div>
    </div>
  
</div>

    <div class="page__footer">
      <footer>
        

<div class="page__footer-follow">
  <ul class="social-icons">
    
    
      <li><a href="https://twitter.com/martincamitz"><i class="fa fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
    
    
    
    
    <li><a href="http://blog.simpletask.se/feed.xml"><i class="fa fa-fw fa-rss-square" aria-hidden="true"></i> </a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2016 Martin Camitz.  <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>
      </footer>
    </div>

    <script src="http://blog.simpletask.se/assets/js/main.min.js"></script>




  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34001047-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>






  
  <script type="text/javascript">
  	/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
  	var disqus_shortname = 'camitz';

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function() {
  		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  	})();

  	/* * * DON'T EDIT BELOW THIS LINE * * */
  	(function () {
  		var s = document.createElement('script'); s.async = true;
  		s.type = 'text/javascript';
  		s.src = '//' + disqus_shortname + '.disqus.com/count.js';
  		(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  	}());
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






    <!-- start custom footer snippets -->

<!-- end custom footer snippets -->

  </body>
</html>

